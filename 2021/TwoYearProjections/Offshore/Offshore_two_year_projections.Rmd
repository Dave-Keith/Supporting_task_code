---
title: "2 year projections"
# output: pdf
#   # flexdashboard::flex_dashboard:
#     # theme: bootstrap
# orientation: columns
# vertical_layout: fill

# storyboard: true
#runtime: shiny
#runtime: shiny_prerendered #  This is supposed to render all the plots right off the bat, so slower first time, but makes moving between pages really quick...
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(dplyr.summarise.inform = FALSE)
options(dplyr.join.inform = FALSE)
require(purrr)

```

```{r}
## run the projections

source("./two_year_projections_offshore.R")

SPscenario <- list(0, 0.1, NULL)
out <- map(SPscenario, function(x) two_year_projections_offshore(area="BBn",
                                                               year=2019, 
                                                               exploitation=0.15, 
                                                               runtype=c("Decision tables and plots"), #"Decision tables only"),
                                                               plot=c("Standard boxplot"), #"Functional boxplot"),
                                                               surplus = x, # if NULL, then it runs the full model, using m, mR, g, gR, etc. For final years, it just repeats them. 
                                                               sample=0.1,
                                                               path="Repo working directory (fast)", 
                                                               save=T))

SPscenario <- list(0, 0.1, NULL)
out <- map(SPscenario, function(x) two_year_projections_offshore(area="GBa",
                                                               year=2019, 
                                                               exploitation=0.25, 
                                                               runtype=c("Decision tables and plots"), #"Decision tables only"),
                                                               plot=c(#"Standard boxplot"
                                                                 "Functional boxplot"),
                                                               surplus = x, # if NULL, then it runs the full model, using m, mR, g, gR, etc. For final years, it just repeats them. 
                                                               sample=0.1,
                                                               path="Repo working directory (fast)", 
                                                               save=T))

```


# Results
```{r}
for(i in 1:length(out)) {
  
  if(i==1) print("Zero surplus production scenario")
  if(i==2) print("Median surplus production scenario")
  if(i==3) print("Last year's surplus production scenario")
  
  
  
  print("Realized projection evaluation")
  
  print(out[[i]]$realized$pred.eval)
  
  print(out[[i]]$realized$zoom.pred.eval)
  
  print(out[[i]]$realized$evaluation1)
  
  print(out[[i]]$realized$evaluation2)
  
  
  
  print("Exploitation-based projection evaluation")
  
  print(out[[1]]$exploit.based$pred.eval)
  
  print(out[[1]]$exploit.based$zoom.pred.eval)
  
  print(out[[1]]$exploit.based$evaluation1)
  
  print(out[[1]]$exploit.based$evaluation2)
  
  
  print("Realized decision from y1 (2020)")
  
  print(out[[1]]$decision.1)
  
  
  print("Range of exploitations for decision for y2 (2021) (based on y1 realized removals)")
  
  print(out[[1]]$decision.2[out[[1]]$decision.2$year==2020,])
  
  
  
  
  print("Decision impact")
  
  print(out[[1]]$evaluation3)
}


```


